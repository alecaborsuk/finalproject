---
title: "Minimum Viable Analysis"
author: "Aleca Borsuk"
date: "11/2/2020"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ape)
library(geiger)
library(ggtree)
library(knitr)
```

## Maximum Likelihood

Maximum likelihood tree for subset of Viburnum taxa constructed using chloroplast sequence data from NCBI and IQTree:

```{r phy}
# read in the phylogeny generated by IQtree 
phy = read.tree("rbcL_aligned.fasta.treefile")
# root the tree; need to follow up to understand what this function is doing
#phy=multi2di(phy)

#root the phylogeny with V. clemensae, sister to rest of genus
root(phy, phy[[4]][72])
#View the phylogeny
plot(phy, no.margin=TRUE,edge.width=2, cex = 0.5)
```


## Mapping Character Data onto the Tree

Visualization of the character 'palisade.type' mapped onto the tree tips. 

```{r}

# View species names
species.names <- phy[[4]]
species.names

# Assign to data frame
D = data.frame(species = phy[[4]],
               palisade.type = c("H1", "I2", "I1","I2", "I1", "H1", "I2", "I2", "I2", "I1", "H1", "H2"))

# View data in table format
kable(D)

# Plot
palisade.type_plot = ggtree(phy) %<+% D + 
  geom_tiplab( fontface = "italic") +
  #xlim(0, 300) +
  geom_tippoint( aes(color=palisade.type), size=3, alpha=1 )

palisade.type_plot

```

```


## Phylogenetically Informed ANOVA

Here using the tree from the above analysis to do a test run of a phylogenetically informed ANOVA. ANOVA method conducted using geiger v2.0 (Pennell et al. 2014):

```{r anova}
# import trait data
df <- read.csv("PalisadeTraits.csv", header = TRUE)
# format discrete data as factor
df$PalisadeType <- as.factor(df$PalisadeType)
# anova function takes named vectors as input
df1= df[,2]
df2 = df[,3]
names(df1)=df[,1]
names(df2)=df[,1]

# run ANOVA
x1=aov.phylo(df2~df1, phy, nsim=50)
#print(attributes(x1)$summary) # summary table

# boxplot visualization
plot(df$Amax~df$PalisadeType)
```
Currently working with a subset of the full dataset, so getting some errors related to missing taxa, which is fine for now. I believe the ANOVA test shows that there is a strong phylogenetic signal for maximum photosynthetic rate (Amax), but that it is not related to palisade cell type. Just testing the method on secondary data; will for the final project have updated trait data, including more traits, to analyze. 
